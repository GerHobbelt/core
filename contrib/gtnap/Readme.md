# GTNap

Harbour cross-platform video subsystem using NAppGUI-SDK
https://github.com/frang75/nappgui_src

## Installing CMake

For building GTNap CMake tool is necessary:

* In Windows:
    * Download from https://cmake.org/download/
    * Select **Add CMake to the system PATH for all users** when installing.
    ![cmake_win](https://user-images.githubusercontent.com/42999199/235419286-0a6101f4-b43b-4e40-a3cb-c585fe908185.png)

* In Linux:
    * `sudo apt-get install cmake cmake-gui`

* Open a terminal/cmd and check if cmake works:
    ```
    :~/$ cmake --version
    cmake version 3.10.2
    ```
## Build GTNap

The `/contrib/gtnap` project consists of several files and folders:

```
/prj        NAppGUI build system
/src        Source code of NAppGUI libraries and gtnap terminal.
/tests      Testing and examples.
build.bat   GTNap build script for Windows.
build.sh    GTNap build script for Linux.
gtnap.hbc   Options for proyects that use GTNap.
gtnap.hbp   GTNap project for hbmk2.
gtnap.hbx   Autogenerated GTNap symbol file.
Readme.md   Documentation.
```

### In Windows
```
:: Goto gtnap folder
cd contrib/gtnap

:: Set the Visual Studio compiler
"%ProgramFiles(x86)%\Microsoft Visual Studio 11.0\VC\vcvarsall.bat"

:: Just build
build.bat -b Debug
build.bat -b Release
```

This will generate several static libraries:

* The GT library: `gtnap.lib` in `/build` folder.
* The NAppGUI libraries: `sewer.lib`, `osbs.lib`, `core.lib`, `geom2d.lib`, `draw2d.lib`, `osgui.lib`, `gui.lib`, `osapp.lib`, `inet.lib` in `build/[Debug|Release]` folder.

### In Linux
```
# Goto gtnap folder
cd contrib/gtnap

# Just build
bash ./build.sh -b Debug
bash ./build.sh -b Release
```

This will generate several static libraries:

* The GT library: `libgtnap.a` in `/build` folder.
* The NAppGUI libraries: `libsewer.a`, `libosbs.a`, `libcore.a`, `libgeom2d.a`, `libdraw2d.a`, `libosgui.a`, `libgui.a`, `libosapp.a`, `libinet.a` in `build/[Debug|Release]` folder.

## Using GTNap

Just adding `-gtnap` flag into your `.hbp` project file.

## Compile and run an CUADEMO example

- To compile in Windows:
   ```
   cd contrib\gtnap\tests\cuademo\gtnap_cualib
   ..\..\..\..\..\bin\win\msvc\hbmk2.exe exemplo.hbp
   exemplo --hb:gtnap
   exemplo --hb:gtwin
   ```

- To compile the semi-graphics (Linux):
   ```
   cd contrib/gtnap/tests/cuademo/gtnap_cualib
   ../../../../../bin/linux/gcc/hbmk2 exemplo.hbp
   ./exemplo --hb:gtnap
   ./exemplo --hb:gttrm
   ```

![gtnap_win](https://user-images.githubusercontent.com/42999199/235419502-456ce304-62cf-4559-b84f-964e20a763d3.png)
![gtnap_linux](https://user-images.githubusercontent.com/42999199/235419548-0ef049d8-6c51-45e2-be4d-393a58c1f07a.png)
![gt_win](https://user-images.githubusercontent.com/42999199/235419608-10188d35-8283-4419-89e2-76def4a13cb4.png)
![gtrtrm_linux](https://user-images.githubusercontent.com/42999199/235419619-9dd0093e-bdd5-4ae8-aac1-1a3b55f96125.png)

## GTNap developer mode

**(Only if you are working on gtnap development)**. Otherwise, you can skip this section.

Using the NAppGUI build system, based on CMake, it is possible to create a single Visual Studio/VSCode solution containing the source code and internal dependencies of: NAppGUI, GTNap and cuademo-example. Thanks to this, it is extremely easy to debug the entire stack and develop a use case that requires all the technologies.

### Step 1. Compile Harbour

**To use developer mode, harbour needs to be recompiled, as a new -keepc option has been introduced in hbmk2.**

* In Windows:
    ```
    :: Set the Visual Studio compiler
    "%ProgramFiles(x86)%\Microsoft Visual Studio 11.0\VC\vcvarsall.bat"

    :: Go to main folder of harbour working copy
    cd harbour_nappgui

    win-make

    ! Building Harbour 3.2.0dev from source - https://harbour.github.io
    ! MAKE: win-make 4.1 sh.exe
    ! HB_HOST_PLAT: win (x86_64)  HB_SHELL: nt
    ! HB_PLATFORM: win (x86) (auto-detected)
    ! HB_COMPILER: msvc (v1700) (auto-detected: C:/Program Files (x86)/Microsoft Visual Studio 11.0/VC/BIN/)
    ! Component: 'zlib' found in c:/harbour_gtnap/src/3rd/zlib (local)
    ...
    ```

* In Linux:
    ```
    # Go to main folder of harbour working copy
    cd harbour_nappgui

    make

    ! Building Harbour 3.2.0dev from source - https://harbour.github.io
    ! MAKE: make 4.1 /bin/sh
    ! HB_HOST_PLAT: linux (x86_64)  HB_SHELL: sh
    ! LD_LIBRARY_PATH: /home/fran/harbour_nappgui/lib/linux/gcc:
    ! HB_PLATFORM: linux (x86_64) (auto-detected)
    ! HB_COMPILER: gcc (auto-detected: /usr/bin/)
    ```

### Step 2. Generate exemplo C files

cuademo-example is a Harbour application. We need the `*.c` files that `hbmk2` generates for the build/debug project. The files will be generated in `/src/example`.

* In Windows:

    ```

    ```

* In Linux:

    ```
    # Go to exemplo folder
    cd contrib/gtnap/tests/cuademo/gtnap_cualib

    # Create exemplo folder in /src
    mkdir ../../../src/exemplo

    # Build exemplo preserving hbmk2 generated C files
    ../../../../../bin/linux/gcc/hbmk2 exemplo.hbp -debug -trace -keepc -workdir=../../../src/exemplo -o../../../build/exemplo exemplo.hbp
    ```

### Step 4. Debugging using VSCode (Linux)

* Install VSCode in Linux

    `sudo apt-get install code`

* Install C/C++ Extension Pack

    https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools-extension-pack

* File->Open folder: `gtnap` folder in `/contrib`. You will see a `.vscode` folder in `gtnap` with the config files to run and debug `exemplo`.

* [F1] CMake:Configure. Will run CMake over `/src/CMakeLists.txt` and generate `build-dev` folder.

* [F1] CMake:Build Target. Select exemplo executable.

* Run and Debug button at VSCode left panel and Exemplo. This will launch the exemplo executable in Debug mode. You will be able to be able to breakpoints in any NAppGUI, GTNap or example source file, inspect variables, step by step, etc.




### OTROS


Just adding `-gtnap` flag into your `.hbp` project file.

For build the exemplo application:

```
cd ./tests/cuademo/gtnap_cualib

hbmk2 exemplo.hbp

./exemplo --hb:gtnap
```

../../bin/linux/gcc/hbmk2 exemplo.hbp

../../bin/linux/gcc/hbmk2 exemplo.hbp




:: Set the compiler
call "%ProgramFiles(x86)%\Microsoft Visual Studio 11.0\VC\vcvarsall.bat"

* At the moment the project compile in:
   * VisualStudio 2012 (windows)
   * Ubuntu 18 GCC 7.5.0 (linux)

GTNAP has been designed with two modes of operation in mind:
   * **Full-Graphic:** Cross-platform "modern" look&feel applications. Not compatible with Harbour/Clipper text command neither CUALIB.
   * **Semi-Graphic:** Cross-platform "cualib-compatible" graphics layer. Improve the appearance of GTWVW solution and runs in Windows/Linux.

![GTNAP_Full_graphic](https://user-images.githubusercontent.com/42999199/202912012-ecc6d479-7455-4cca-85f6-05cd57730407.png)
![GTNAP_Semil_graphic](https://user-images.githubusercontent.com/42999199/202912021-e6ffcd8b-08b5-494f-ae1a-f78b6403bddb.png)

## Compile Harbour

- Clone the harbour repository

```
git clone https://github.com/frang75/harbour_nappgui.git
```

- Compile in VS 2012:

    * Open Developer Command Prompt for VS2012

    * Go to ``harbour_nappgui`` working copy

    * ``win-make``

    ```
    ! Building Harbour 3.2.0dev from source - https://harbour.github.io
    ! MAKE: win-make 4.1 sh.exe
    ! HB_HOST_PLAT: win (x86_64)  HB_SHELL: nt
    ! HB_PLATFORM: win (x86) (auto-detected)
    ! HB_COMPILER: msvc (v1700) (auto-detected: C:/Program Files (x86)/Microsoft Visual Studio 11.0/VC/BIN/)
    ! Component: 'zlib' found in c:/harbour_gtnap/src/3rd/zlib (local)
    ...
    ```

- Compile in Ubuntu 18:

   * Open a Terminal

   * Go to ``harbour_nappgui`` working copy

   * ``make``

## Compile **GTNAP**

- Compile in VS 2012:

   * Open Developer Command Prompt for VS2012

   * Go to `gtnap` working copy `(cd C:\harbour_nappgui\contrib\gtnap)`

   * `..\..\bin\win\msvc\hbmk2.exe gtnap.hbp`

   * This will generate: `hbmk2: Target up to date: build\msvc\gtnap.lib`

- Compile in Ubuntu 18:

   * Open a Terminal

   * Go to `gtnap` working copy `(cd harbour_nappgui/contrib/gtnap)`

   * `../../bin/linux/gcc/hbmk2 gtnap.hbp`

   * This will generate: `hbmk2: Target up to date: build/gcc/libgtnap.a`


## Compile and run an CUADEMO example FULL GRAPHICS

- To compile the full-graphics (Windows):
   * `cd C:\harbour_nappgui\contrib\gtnap\tests\cuademo\gtnap_pure`
   * `..\..\..\..\..\bin\win\msvc\hbmk2.exe exemplo.hbp`
   * `exemplo`

- To compile the full-graphics (Linux):

   * `cd harbour_nappgui/contrib/gtnap/tests/cuademo/gtnap_pure`
   * `../../../../../bin/linux/gcc/hbmk2 exemplo.hbp`
   * `./exemplo`

![exemplo_full_graphics_windows](https://user-images.githubusercontent.com/42999199/202913860-fdb93eb1-08bd-42c1-ae8b-95687dd8b7fd.png)
![exemplo_full_graphics_linux](https://user-images.githubusercontent.com/42999199/202913872-9700e5c1-1763-4453-8907-d8531c829c1e.png)




# GTNAP Log

GTNAP generates a log file.

```
[17:39:13] Starting log for 'exemplo'
[17:39:13] i_gtnap_cualib_create(Exemplo das rotinas de janelamento, 35, 110)
[17:39:13] hb_gtnap_GetCursorStyle()
[17:39:13] hb_gtnap_SetCursorStyle(0)
[17:39:13] hb_gtnap_DispCount()
[17:39:13] hb_gtnap_GetBlink()
[17:39:13] hb_gtnap_SetBlink(0)
[17:39:13] hb_gtnap_MaxRow()
[17:39:13] hb_gtnap_MaxCol()
[17:39:13] hb_gtnap_MaxRow()
[17:39:13] hb_gtnap_MaxCol()
[17:39:13] hb_gtnap_Version(0)
[17:39:13] hb_gtnap_MaxRow()
[17:39:13] hb_gtnap_MaxRow()
[17:39:13] hb_gtnap_MaxCol()
[17:39:13] hb_gtnap_Version(0)
[17:39:13] hb_gtnap_GetCursorStyle()
[17:39:13] hb_gtnap_SetCursorStyle(0)
[17:39:13] hb_gtnap_DispCount()
[17:39:13] hb_gtnap_GetPos(0, 0). NO GTNAP Window!
[17:39:13] hb_gtnap_GetPos(0, 0). NO GTNAP Window!
[17:39:13] hb_gtnap_Version(0)
[17:39:14] hb_gtnap_MaxRow()
[17:39:14] hb_gtnap_MaxCol()
[17:39:14] hb_gt_wvw_Scroll(0, 0, 35, 110): Rows:(0) Cols:(0) Color(112)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_Version(0)
[17:39:14] hb_gtnap_DispBegin()
[17:39:14] hb_gtnap_SetPos(0, 1)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(0, 1)
[17:39:14] hb_gtnap_WriteAt(0, 1, 109):                                           Escolha o tipo de janela
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(0, 0)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(0, 0)
[17:39:14] hb_gtnap_WriteAt(0, 0, 10): SAY in 0,0
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(1, 1)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(1, 1)
[17:39:14] hb_gtnap_WriteAt(1, 1, 10): SAY in 1,1
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(2, 2)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(2, 2)
[17:39:14] hb_gtnap_WriteAt(2, 2, 10): SAY in 2,2
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(3, 3)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(3, 3)
[17:39:14] hb_gtnap_WriteAt(3, 3, 10): SAY in 3,3
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(4, 4)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(4, 4)
[17:39:14] hb_gtnap_WriteAt(4, 4, 10): SAY in 4,4
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(5, 5)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(5, 5)
[17:39:14] hb_gtnap_WriteAt(5, 5, 10): SAY in 5,5
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(6, 6)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(6, 6)
[17:39:14] hb_gtnap_WriteAt(6, 6, 10): SAY in 6,6
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(7, 7)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(7, 7)
[17:39:14] hb_gtnap_WriteAt(7, 7, 10): SAY in 7,7
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(8, 8)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(8, 8)
[17:39:14] hb_gtnap_WriteAt(8, 8, 10): SAY in 8,8
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(9, 9)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(9, 9)
[17:39:14] hb_gtnap_WriteAt(9, 9, 10): SAY in 9,9
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(10, 10)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(10, 10)
[17:39:14] hb_gtnap_WriteAt(10, 10, 12): SAY in 10,10
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(11, 11)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(11, 11)
[17:39:14] hb_gtnap_WriteAt(11, 11, 12): SAY in 11,11
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(12, 12)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(12, 12)
[17:39:14] hb_gtnap_WriteAt(12, 12, 12): SAY in 12,12
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(13, 13)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(13, 13)
[17:39:14] hb_gtnap_WriteAt(13, 13, 12): SAY in 13,13
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(14, 14)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(14, 14)
[17:39:14] hb_gtnap_WriteAt(14, 14, 12): SAY in 14,14
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(15, 15)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(15, 15)
[17:39:14] hb_gtnap_WriteAt(15, 15, 12): SAY in 15,15
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(16, 16)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(16, 16)
[17:39:14] hb_gtnap_WriteAt(16, 16, 12): SAY in 16,16
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(17, 17)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(17, 17)
[17:39:14] hb_gtnap_WriteAt(17, 17, 12): SAY in 17,17
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(18, 18)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(18, 18)
[17:39:14] hb_gtnap_WriteAt(18, 18, 12): SAY in 18,18
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(19, 19)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(19, 19)
[17:39:14] hb_gtnap_WriteAt(19, 19, 12): SAY in 19,19
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_SetPos(20, 20)
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_GetPos(20, 20)
[17:39:14] hb_gtnap_WriteAt(20, 20, 12): SAY in 20,20
[17:39:14] hb_gtnap_DispCount()
[17:39:14] hb_gtnap_Version(0)
[17:40:08] hb_gtnap_GetCursorStyle()
[17:40:08] hb_gtnap_SetCursorStyle(1)
[17:40:08] hb_gtnap_DispCount()
[17:40:08] hb_gtnap_Version(0)
[17:40:08] hb_gtnap_SetPos(0, 0). NO GTNAP Window!
[17:40:08] hb_gtnap_DispCount()
[17:40:08] hb_gtnap_GetCursorStyle()
[17:40:08] hb_gtnap_SetCursorStyle(1)
[17:40:08] hb_gtnap_DispCount()
[17:40:08] hb_gtnap_Version(0)
[17:40:08] i_gtnap_cualib_destroy()
[17:40:08] [OK] Heap Memory Staticstics
[17:40:08] ============================
[17:40:08] Total a/dellocations: 190, 190
[17:40:08] Total bytes a/dellocated: 16991, 16991
[17:40:08] Max bytes allocated: 16099
[17:40:08] Effective reallocations: (0/4)
[17:40:08] Real allocations: 1 pages of 65536 bytes
[17:40:08] ============================
[17:40:08] Config: Debug
[17:40:08] You have an execution log in: 'C:\Users\USUARIO\AppData\Roaming\exemplo\log.txt'
[17:40:08] hb_gtnap_DispCount()
[17:40:08] hb_gtnap_DispCount()
[17:40:08] hb_gtnap_Exit()
```



